<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rewards Chart</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<div class="stats" id="stats0"></div>
<div class="stats" id="stats1"></div>
  
<style>
body{font-family:Arial;background:#f2f7ff;margin:0;padding:16px}
h1{text-align:center}
.container{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}
@media(max-width:900px){.container{grid-template-columns:1fr}}

.card{background:#fff;border-radius:20px;padding:16px;box-shadow:0 10px 25px rgba(0,0,0,.12)}
.avatar{text-align:center;font-size:40px}
.name{text-align:center;font-size:22px;font-weight:bold}

.progress{background:#ddd;height:14px;border-radius:10px;overflow:hidden;margin:10px 0}
.progress span{display:block;height:100%;width:0%;transition:.3s}

.blue{background:#4da3ff}
.green{background:#5ecf8e}

.section-title{text-align:center;color:#fff;font-weight:bold;padding:6px;border-radius:12px;margin-top:10px}
.morning{background:#ffb74d}
.afternoon{background:#81c8f8}
.evening{background:#9575cd}

.task{display:flex;justify-content:space-between;align-items:center;padding:6px 0}
.check{width:30px;height:30px;border-radius:50%;border:none;background:#ffd54f;cursor:pointer;position:relative}
.check::after{content:"âœ“";color:#fff;font-size:20px;position:absolute;top:50%;left:50%;transform:translate(-50%,-55%);opacity:0}
.check.checked{background:#4caf50}
.check.checked::after{opacity:1}

.stats{background:#eef6ff;padding:10px;border-radius:12px;text-align:center;margin-top:10px}

.rewards{background:#fff1dc;padding:10px;border-radius:12px;margin-top:12px}
.reward{background:#ff8fa3;color:#fff;padding:8px;border-radius:10px;margin-top:6px;text-align:center;cursor:pointer}

.reset{text-align:center;margin-top:10px}

.race{background:#fff;border-radius:18px;padding:14px;margin-bottom:20px;box-shadow:0 6px 18px rgba(0,0,0,.1)}
.track{background:#ddd;height:20px;border-radius:12px;overflow:hidden;margin:6px 0}
.runner{height:100%;width:0%;transition:.4s}
</style>
</head>

<body>

<h1>â­ Rewards Chart â­</h1>

<div class="race">
<b>ğŸ Star Race</b>
Adam
<div class="track"><div id="race0" class="runner blue"></div></div>
Lachlan
<div class="track"><div id="race1" class="runner green"></div></div>
</div>

<div class="container">

<!-- ADAM -->
<div class="card">
  <div class="avatar">ğŸš€</div>
  <div class="name">Adam</div>
  <div class="progress"><span class="blue"></span></div>

  <div class="section">
    <div class="section-title morning">Morning</div>
    <div class="task"><span>ğŸ‘• Get dressed â­1</span><button class="check" data-id="a-m-1" onclick="toggleTask(this,0,1)"></button></div>
    <div class="task"><span>ğŸ›ï¸ Make bed â­1</span><button class="check" data-id="a-m-2" onclick="toggleTask(this,0,1)"></button></div>
    <div class="task"><span>ğŸ§¼ Wash face â­1</span><button class="check" data-id="a-m-3" onclick="toggleTask(this,0,1)"></button></div>
    <div class="task"><span>ğŸ’ Pack bag â­1</span><button class="check" data-id="a-m-4" onclick="toggleTask(this,0,1)"></button></div>
  </div>

  <div class="section">
    <div class="section-title afternoon">Afternoon</div>
    <div class="task"><span>ğŸ’ Unpack bag â­2</span><button class="check" data-id="a-a-1" onclick="toggleTask(this,0,2)"></button></div>
    <div class="task"><span>ğŸ“š Homework â­2</span><button class="check" data-id="a-a-2" onclick="toggleTask(this,0,2)"></button></div>
    <div class="task"><span>ğŸ½ï¸ Set table â­2</span><button class="check" data-id="a-a-3" onclick="toggleTask(this,0,2)"></button></div>
    <div class="task"><span>ğŸ“– Reading â­3</span><button class="check" data-id="a-a-4" onclick="toggleTask(this,0,3)"></button></div>
  </div>

  <div class="section">
    <div class="section-title evening">Evening</div>
    <div class="task"><span>ğŸ½ï¸ Clean table â­1</span><button class="check" data-id="a-e-1" onclick="toggleTask(this,0,1)"></button></div>
    <div class="task"><span>ğŸš¿ Shower & teeth â­1</span><button class="check" data-id="a-e-2" onclick="toggleTask(this,0,1)"></button></div>
    <div class="task"><span>ğŸ½ï¸ Dishwasher â­3</span><button class="check" data-id="a-e-3" onclick="toggleTask(this,0,3)"></button></div>
  </div>

   <div class="stats" id="stats0"></div>
  
  <div class="rewards">
  <div class="reward" onclick="redeem(0,5,false)">ğŸª Treat â€“ â­5</div>
  <div class="reward" onclick="redeem(0,30,true)">ğŸ“º 1 Hour YouTube â€“ â­30</div>
  <div class="reward" onclick="redeem(0,40,true)">ğŸ¬ Movie Night â€“ â­40</div>
  <div class="reward" onclick="redeem(0,40,true)">ğŸ² Board Game Night â€“ â­40</div>
</div>

   <div class="reset"><button onclick="resetChild(0)">ğŸ”’ Parent Reset</button></div>
</div>

<!-- LACHLAN -->
<div class="card">
  <div class="avatar">ğŸ¯</div>
  <div class="name">Lachlan</div>
  <div class="progress"><span class="green"></span></div>

  <div class="section">
    <div class="section-title morning">Morning</div>
    <div class="task"><span>ğŸ‘• Get dressed â­1</span><button class="check" data-id="l-m-1" onclick="toggleTask(this,1,1)"></button></div>
    <div class="task"><span>ğŸ›ï¸ Make bed â­1</span><button class="check" data-id="l-m-2" onclick="toggleTask(this,1,1)"></button></div>
    <div class="task"><span>ğŸ§¼ Wash face â­1</span><button class="check" data-id="l-m-3" onclick="toggleTask(this,1,1)"></button></div>
    <div class="task"><span>ğŸ’ Pack bag â­1</span><button class="check" data-id="l-m-4" onclick="toggleTask(this,1,1)"></button></div>
  </div>

  <div class="section">
    <div class="section-title afternoon">Afternoon</div>
    <div class="task"><span>ğŸ’ Unpack bag â­2</span><button class="check" data-id="l-a-1" onclick="toggleTask(this,1,2)"></button></div>
    <div class="task"><span>ğŸ“š Homework â­2</span><button class="check" data-id="l-a-2" onclick="toggleTask(this,1,2)"></button></div>
    <div class="task"><span>ğŸ½ï¸ Set table â­2</span><button class="check" data-id="l-a-3" onclick="toggleTask(this,1,2)"></button></div>
    <div class="task"><span>ğŸ“– Reading â­3</span><button class="check" data-id="l-a-4" onclick="toggleTask(this,1,3)"></button></div>
  </div>

  <div class="section">
    <div class="section-title evening">Evening</div>
    <div class="task"><span>ğŸ½ï¸ Clean table â­1</span><button class="check" data-id="l-e-1" onclick="toggleTask(this,1,1)"></button></div>
    <div class="task"><span>ğŸš¿ Shower & teeth â­1</span><button class="check" data-id="l-e-2" onclick="toggleTask(this,1,1)"></button></div>
    <div class="task"><span>ğŸ§º Put laundry away â­3</span><button class="check" data-id="l-e-3" onclick="toggleTask(this,1,3)"></button></div>
  </div>

  <div class="stats" id="stats1"></div>
  
  <div class="rewards">
  <div class="reward" onclick="redeem(1,5,false)">ğŸª Treat â€“ â­5</div>
  <div class="reward" onclick="redeem(1,30,true)">ğŸ“º 1 Hour YouTube â€“ â­30</div>
  <div class="reward" onclick="redeem(1,40,true)">ğŸ¬ Movie Night â€“ â­40</div>
  <div class="reward" onclick="redeem(1,40,true)">ğŸ² Board Game Night â€“ â­40</div>
</div>


<div class="reset"><button onclick="resetChild(1)">ğŸ”’ Parent Reset</button></div>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  databaseURL: "https://rewards-app-12c6f-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database().ref("chart");

const PIN="9747", DAILY_GOAL=10;

let data = {
  kids: [
    { daily: 0, weekly: 0 },
    { daily: 0, weekly: 0 }
  ],
  checked: {},        // âœ… stores checked task IDs
  lastDailyReset: "",
  lastWeeklyReset: ""
};

db.on("value",s=>{
 if(s.exists()) data=s.val();
 restoreChecks();
 render();
});

function toggleTask(btn, kidIndex, stars){
  const id = btn.dataset.id;

  if(!data.checked) data.checked = {};

  // ğŸ”’ UNCHECK (parent only)
  if(btn.classList.contains("checked")){
    if(prompt("Enter parent PIN") !== PIN) return;

    btn.classList.remove("checked");
    delete data.checked[id];

    data.kids[kidIndex].daily =
      Math.max(0, data.kids[kidIndex].daily - stars);
    data.kids[kidIndex].weekly =
      Math.max(0, data.kids[kidIndex].weekly - stars);
  }
  // âœ… CHECK
  else{
    btn.classList.add("checked");
    data.checked[id] = true;

    data.kids[kidIndex].daily += stars;
    data.kids[kidIndex].weekly += stars;
  }

  save();
}


function restoreChecks(){
  document.querySelectorAll(".check").forEach(btn=>{
    btn.classList.toggle(
      "checked",
      data.checked && data.checked[btn.dataset.id]
    );
  });
}
  
function render(){
  data.kids.forEach((kid, i) => {

    // â­ Tallies
    document.getElementById("stats"+i).innerHTML =
      `â­ Today: ${kid.daily}<br>â­ This Week: ${kid.weekly}`;

    // ğŸ“Š Daily bar (optional)
    const bar = document.querySelectorAll(".progress span")[i];
    if(bar){
      bar.style.width = Math.min((kid.daily / 18) * 100, 100) + "%";
    }

    // ğŸ Race bar (weekly)
    const race = document.getElementById("race"+i);
    if(race){
      race.style.width = Math.min((kid.weekly / 100) * 100, 100) + "%";
    }
  });

  restoreChecks();
}


function resetChild(i){
  if(prompt("Enter parent PIN") !== PIN) return;

  // Reset stars
  data.kids[i].daily = 0;
  data.kids[i].weekly = 0;

  // Remove only THIS childâ€™s checks
  Object.keys(data.checked).forEach(id=>{
    if(id.startsWith(i === 0 ? "a-" : "l-")){
      delete data.checked[id];
    }
  });

  save();
}

function redeem(i,cost){
 if(data.kids[i].weekly<cost) return alert("Not enough stars");
 if(prompt("Parent PIN")!==PIN) return;
 data.kids[i].weekly-=cost;
 save();
}

function save(){
  dbRef.set(data);
}

function loadData(){
  dbRef.on("value", snap=>{
    if(snap.exists()){
      data = snap.val();
    }
    render();
  });
}

loadData();
  
function autoResets(){
  const now = new Date();
  const today = now.toDateString();

  // ğŸŒ™ DAILY
  if(data.lastDailyReset !== today){
    data.kids.forEach(k => k.daily = 0);
    data.checked = {};
    data.lastDailyReset = today;
  }

  // ğŸ“… WEEKLY (Monday)
  const monday = new Date(now);
  monday.setDate(now.getDate() - ((now.getDay()+6)%7));
  const weekKey = monday.toDateString();

  if(data.lastWeeklyReset !== weekKey){
    data.kids.forEach(k => k.weekly = 0);
    data.lastWeeklyReset = weekKey;
  }

  save();
}
setTimeout(autoResets, 1000);
</script>

</body>
</html>
